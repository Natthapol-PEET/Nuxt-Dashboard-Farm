# python 3.6

import json
import random
import time

from paho.mqtt import client as mqtt_client


msg = "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"

# broker = 'broker.emqx.io'
broker = '192.168.1.104'
port = 1883
topic = "plant/dashboard/image"
# generate client ID with pub prefix randomly
client_id = f'python-mqtt-{random.randint(0, 1000)}'
username = 'emqx'
password = 'public'


def connect_mqtt():
    def on_connect(client, userdata, flags, rc):
        if rc == 0:
            print("Connected to MQTT Broker!")
        else:
            print("Failed to connect, return code %d\n", rc)

    client = mqtt_client.Client(client_id)
    client.username_pw_set(username, password)
    client.on_connect = on_connect
    client.connect(broker, port)
    return client


def publish(client):
    time.sleep(5)
    
    data = {
        "status": "next",
        "originalImage": msg,
        "ndviImage": msg,
    }
    payload = json.dumps(data)
    result = client.publish("plant/dashboard/image", payload)
    
    time.sleep(5)
    
    data = {
        "status": "end",
        "originalImage": msg,
        "ndviImage": msg,
    }
    payload = json.dumps(data)
    result = client.publish("plant/dashboard/image", payload)
    
    time.sleep(5)


def run():
    client = connect_mqtt()
    client.loop_start()
    publish(client)


if __name__ == '__main__':
    run()
